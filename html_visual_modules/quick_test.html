<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Test: 5 - 3 Number Line</title>
    <link rel="stylesheet" href="shared-styles.css">
</head>
<body>
    <div class="math-visual-container">
        <h1 style="text-align: center; color: #00ff00; margin-bottom: 20px;">
            Quick Test: 5 - 3 on Number Line
        </h1>
        
        <div class="math-problem-statement" id="problemStatement">
            5 - 3 = ?
        </div>
        
        <div style="position: relative; width: 100%; max-width: 600px; margin: 0 auto;">
            <canvas id="numberlineCanvas" class="numberline-canvas" style="width: 100%; height: 120px;"></canvas>
        </div>

        <div class="math-controls">
            <button id="animateBtn" class="math-btn">Animate Subtraction</button>
            <button id="showHintBtn" class="math-btn">Show Hint</button>
            <button id="resetBtn" class="math-btn">Reset</button>
        </div>

        <div class="math-controls">
            <input type="number" id="answerInput" class="math-answer-input" placeholder="Enter your answer">
            <button id="submitBtn" class="math-btn">Submit</button>
        </div>

        <div id="feedbackContainer"></div>
    </div>

    <script src="shared-utils.js"></script>
    <script>
        // Simplified NumberLineVisualizer for this specific test
        class SimpleNumberLineVisualizer {
            constructor(containerId) {
                this.canvas = document.getElementById(containerId);
                this.ctx = MathVisualUtils.getCanvasContext(this.canvas);
                this.setupCanvas();
                this.setupEventListeners();
            }

            setupCanvas() {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width * window.devicePixelRatio;
                this.canvas.height = rect.height * window.devicePixelRatio;
                this.ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            }

            setupEventListeners() {
                document.getElementById('animateBtn').addEventListener('click', () => this.animateSubtraction());
                document.getElementById('showHintBtn').addEventListener('click', () => this.showHint());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetVisualization());
                document.getElementById('submitBtn').addEventListener('click', () => this.submitAnswer());
                
                document.getElementById('answerInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.submitAnswer();
                    }
                });
            }

            drawNumberLine() {
                const canvas = this.canvas;
                const ctx = this.ctx;
                const width = canvas.width / window.devicePixelRatio;
                const height = canvas.height / window.devicePixelRatio;

                // Clear canvas
                ctx.clearRect(0, 0, width, height);

                // Draw grid
                MathVisualUtils.drawGrid(ctx, width, height, 20, '#00ff00', 0.1);

                // Calculate number line parameters
                const padding = 40;
                const lineY = height / 2;
                const lineStartX = padding;
                const lineEndX = width - padding;
                const lineLength = lineEndX - lineStartX;

                // Scale for 5 - 3 = 2 (range 0 to 6)
                const minVal = 0;
                const maxVal = 6;
                const range = maxVal - minVal;
                const scale = lineLength / range;

                // Draw number line
                ctx.save();
                ctx.strokeStyle = '#00ff00';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(lineStartX, lineY);
                ctx.lineTo(lineEndX, lineY);
                ctx.stroke();

                // Draw tick marks and labels
                for (let i = minVal; i <= maxVal; i++) {
                    const x = lineStartX + (i - minVal) * scale;
                    
                    // Draw tick mark
                    ctx.beginPath();
                    ctx.moveTo(x, lineY - 10);
                    ctx.lineTo(x, lineY + 10);
                    ctx.stroke();

                    // Draw label
                    MathVisualUtils.drawGlowText(ctx, i.toString(), x, lineY + 25, 12);
                }

                // Draw start position (5)
                const startX = lineStartX + (5 - minVal) * scale;
                this.drawPositionMarker(startX, lineY, '#00ff00', 'START (5)');

                // Draw result position (2)
                const resultX = lineStartX + (2 - minVal) * scale;
                this.drawPositionMarker(resultX, lineY, '#ffff00', 'RESULT (2)');

                ctx.restore();
            }

            drawPositionMarker(x, y, color, label) {
                const ctx = this.ctx;
                
                ctx.save();
                ctx.fillStyle = color;
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                
                // Draw circle
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, 2 * Math.PI);
                ctx.fill();
                ctx.stroke();
                
                // Draw label
                MathVisualUtils.drawGlowText(ctx, label, x, y - 20, 10, color);
                
                ctx.restore();
            }

            animateSubtraction() {
                const canvas = this.canvas;
                const ctx = this.ctx;
                const width = canvas.width / window.devicePixelRatio;
                const height = canvas.height / window.devicePixelRatio;
                const padding = 40;
                const lineY = height / 2;
                const lineStartX = padding;
                const lineLength = (width - 2 * padding);

                const minVal = 0;
                const maxVal = 6;
                const range = maxVal - minVal;
                const scale = lineLength / range;

                const startX = lineStartX + (5 - minVal) * scale;
                const endX = lineStartX + (2 - minVal) * scale;

                let currentX = startX;
                const stepSize = (endX - startX) / 20;
                const stepDelay = 150;

                let step = 0;
                const animateStep = () => {
                    if (step >= 20) {
                        this.drawNumberLine();
                        return;
                    }

                    // Clear and redraw
                    this.drawNumberLine();

                    // Draw moving marker
                    ctx.save();
                    ctx.fillStyle = '#ff0000';
                    ctx.strokeStyle = '#ff0000';
                    ctx.lineWidth = 3;
                    
                    ctx.beginPath();
                    ctx.arc(currentX, lineY, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();
                    
                    // Draw arrow showing direction (left for subtraction)
                    MathVisualUtils.drawArrow(ctx, currentX, lineY - 15, 
                        currentX - 20, lineY - 15, '#ff0000', 2);
                    
                    ctx.restore();

                    currentX += stepSize;
                    step++;

                    setTimeout(animateStep, stepDelay);
                };

                animateStep();
            }

            showHint() {
                MathVisualUtils.showFeedback(
                    document.getElementById('feedbackContainer'),
                    'Start at 5 and move 3 steps to the left',
                    'hint'
                );
            }

            submitAnswer() {
                const input = document.getElementById('answerInput');
                const userAnswer = parseInt(input.value);

                if (!MathVisualUtils.validateNumericInput(input.value)) {
                    MathVisualUtils.showFeedback(
                        document.getElementById('feedbackContainer'),
                        'Please enter a valid number',
                        'incorrect'
                    );
                    return;
                }

                const isCorrect = userAnswer === 2;
                
                if (isCorrect) {
                    MathVisualUtils.showFeedback(
                        document.getElementById('feedbackContainer'),
                        'Correct! 5 - 3 = 2',
                        'correct'
                    );
                    MathVisualUtils.createPulseEffect(document.getElementById('numberlineCanvas'));
                } else {
                    MathVisualUtils.showFeedback(
                        document.getElementById('feedbackContainer'),
                        'Incorrect. The answer is 2',
                        'incorrect'
                    );
                }
            }

            resetVisualization() {
                document.getElementById('answerInput').value = '';
                const feedbackContainer = document.getElementById('feedbackContainer');
                feedbackContainer.innerHTML = '';
                this.drawNumberLine();
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const visualizer = new SimpleNumberLineVisualizer('numberlineCanvas');
            visualizer.drawNumberLine();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.visualizer) {
                window.visualizer.setupCanvas();
                window.visualizer.drawNumberLine();
            }
        });
    </script>
</body>
</html>
